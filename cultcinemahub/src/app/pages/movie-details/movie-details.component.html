<div *ngIf="movie" class="container">
  <div class="movie-details-wrapper" id="movie-details-wrapper">
    <div class="overlay"></div>
    <h1>{{ movie.title }}</h1>
    <div class="movie-details-content d-flex align-items-start justify-content-start gap-5">
      <img [src]="movie.posterImg || 'assets/img/default/default-movie.png'" (error)="onImageError($event)" class="img-thumbnail mt-2" alt="Poster">
      <div class="details-text">
        <span *ngFor="let genre of getGenres()" class="badge rounded-pill text-bg-secondary me-1 my-5">{{ genre }}</span>
        <p><strong>Anno:</strong> {{ movie.year }}</p>
        <p><strong>Durata:</strong> {{ movie.duration }} minuti</p>


        <p><strong>Descrizione:</strong> {{ movie.description }}</p>
        <p><strong>Valutazione Media:</strong> {{ getAverageRating() }}</p>
        <p *ngIf="movie.cast && movie.cast.length"><strong>Cast:</strong> {{ getCast() }}</p>
        <p *ngIf="movie.directors && movie.directors.length"><strong>Registi:</strong> {{ getDirectors() }}</p>
        <p *ngIf="movie.screenwriters && movie.screenwriters.length"><strong>Sceneggiatori:</strong> {{ getScreenwriters() }}</p>
        <p *ngIf="movie.producers && movie.producers.length"><strong>Produttori:</strong> {{ getProducers() }}</p>
        <p *ngIf="movie.distributor"><strong>Distributore:</strong> {{ movie.distributor.name }}</p>
      </div>
    </div>

    <button *ngIf="canAddReview()" class="btn btn-primary my-4" (click)="openAddReviewModal()">Aggiungi Recensione</button>

    <h3 *ngIf="movie.reviews?.length" class="my-3">Recensioni</h3>
    <app-review *ngFor="let review of movie.reviews ?? []"
                [review]="review"
                [currentUser]="currentUser"
                (addComment)="openAddCommentModal($event)"
                (editReview)="openEditReviewModal($event)"
                (deleteReview)="deleteReview($event)"
                (editComment)="onEditComment($event)"
                (deleteComment)="onDeleteComment($event.commentId)"
                (replyComment)="openAddCommentModal(undefined, $event)">
    </app-review>
  </div>
</div>
